<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>Floorfilter - JSAPI3</title>
    <link rel="stylesheet" href="https://js.arcgis.com/3.28/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="https://js.arcgis.com/3.28/esri/css/esri.css">
    <link rel="stylesheet" href="./floorfilter/style/main.css">
    <style>
      html, body, #map {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #layerlist {
        position: absolute;
        top: 70vh;
        left: 10px;
        height: 20vh;
        overflow-y: auto;
      }
      #floorfilter {
        position: absolute;
        top: 20px;
        left: 100px;
      }
    </style>
    <script>
      var dojoConfig = {
        async: true,
        packages: [
          {
            name: "floorfilter",
            location: location.pathname.replace(/\/[^/]*$/,"") + "/floorfilter"
          }
        ]
      };
    </script>
    <script src="https://js.arcgis.com/3.28/"></script>
    <script>
      var map;
      require([
        "esri/map",
        "esri/arcgis/utils",
        "esri/dijit/LayerList",
        "floorfilter/FloorFilter",
        "dojo/domReady!"
      ], function(
        Map,
        arcgisUtils,
        LayerList,
        FloorFilter) {

        var portalUrl = "https://indoorsportal2.esri.com/portal";
        var webmapId = "b95a6f5169b0461787c6c3d5c01c8552"; // fs
        //var webmapId = "ce8e7241ead34e06bfa4082342e87d51"; //fs
        //var webmapId = "18f0da0feaa14a68a4a55605a63c8799"; // ms
        //var webmapId = "beb205a97a6245739704cee0ea957d84"; // ms

        arcgisUtils.arcgisUrl = portalUrl + "/sharing/rest/content/items/";
        arcgisUtils.createMap(webmapId,"map").then(function (response) {
          var map = response.map;
          window.map = map;
          //dojo.disconnect(response.clickEventHandle);

          var layerList = new LayerList({
            map: map,
            showLegend: false,
            showSubLayers: true,
            showOpacitySlider: false,
            layers: arcgisUtils.getLayerList(response)
          },"layerlist");
          layerList.startup();

          var layerIdentifiers = {
            facilities: 0,
            levels: 8,
          };
          
          var floorFilter = new FloorFilter({
            map: map
          },"floorfilter");
        });

      });
    </script>
  </head>
  <body class="claro esri">
    <div id="map"></div>
    <div id="layerlist"></div>
    <div id="floorfilter"></div>
  </body>
</html>
