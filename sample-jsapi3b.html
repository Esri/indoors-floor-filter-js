<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>Floorfilter - JSAPI3 - b</title>
    <link rel="stylesheet" href="https://js.arcgis.com/3.28/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="https://js.arcgis.com/3.28/esri/css/esri.css">
    <link rel="stylesheet" href="./floorfilter/style/main.css">
    <style>
      html, body, #map {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #layerlist {
        position: absolute;
        top: 70vh;
        left: 10px;
        height: 20vh;
        overflow-y: auto;
      }
      #floorfilter {
        position: absolute;
        top: 20px;
        left: 100px;
      }
    </style>
    <script>
      var dojoConfig = {
        async: true,
        packages: [
          {
            name: "floorfilter",
            location: location.pathname.replace(/\/[^/]*$/,"") + "/floorfilter"
          }
        ]
      };
    </script>
    <script src="https://js.arcgis.com/3.28/"></script>
    <script>
      require([
        "esri/map",
        "esri/layers/ArcGISDynamicMapServiceLayer",
        "esri/layers/FeatureLayer",
        "esri/arcgis/utils",
        "esri/dijit/LayerList",
        "floorfilter/FloorFilter",
        "dojo/domReady!"
      ], function(
        Map,
        ArcGISDynamicMapServiceLayer,
        FeatureLayer,
        arcgisUtils,
        LayerList,
        FloorFilter) {

        var portalUrl = "https://indoorsportal2.esri.com/portal";
        var facilitiesUrl = "https://indoorsportal2.esri.com/arcgis/rest/services/Hosted/Redlands_AIIM_1_1_FeatureService_WFL1/FeatureServer/0";
        var levelsUrl = "https://indoorsportal2.esri.com/arcgis/rest/services/Hosted/Redlands_AIIM_1_1_FeatureService_WFL1/FeatureServer/8";
        var unitsUrl = "https://indoorsportal2.esri.com/arcgis/rest/services/Hosted/Redlands_AIIM_1_1_FeatureService_WFL1/FeatureServer/7";

        var msUrl = "https://indoorsportal2.esri.com/arcgis/rest/services/Redlands_AIIM_1_1_MapService_MIL1/MapServer";

        var map = new Map("map", {
          basemap: "topo",
          center: [-117.1976513, 34.0568092],
          zoom: 22
        });

        var layer = new ArcGISDynamicMapServiceLayer(msUrl);
        //var layer = new FeatureLayer(unitsUrl);
        map.addLayer(layer);

        var layerList = new LayerList({
          map: map,
          showLegend: false,
          showSubLayers: true,
          showOpacitySlider: false
        },"layerlist");
        layerList.startup();

        var floorFilter = new FloorFilter({
          map: map,
          facilitiesUrl: facilitiesUrl,
          levelsUrl: levelsUrl
        },"floorfilter");

      });
    </script>
  </head>
  <body class="claro esri">
    <div id="map"></div>
    <div id="layerlist"></div>
    <div id="floorfilter"></div>
  </body>
</html>
